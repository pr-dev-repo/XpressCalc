!function(e){"use strict";let t={processSingleInput:function(e){let t=e.value.trim();if(this.clearError(e),!t.startsWith("="))return;let r=t.substring(1);console.log("Processing formula:",r);let s=this.evaluateFormula(r);s.success?e.value=s.result:(this.setError(e,s.error),alert(s.error))},validateKeypress:function(e){let t=e.target,r=e.key,s=t.value;if(this.clearError(t),["Backspace","Tab","Enter","ArrowLeft","ArrowRight","Delete"].includes(r))return;let n=s.startsWith("=");if(!/\d/.test(r)){if("="===r){(s.includes("=")||0!==t.selectionStart)&&e.preventDefault();return}if(n){if(["+","-","*","/","(",")"].includes(r))return}else if(["+","-","*","/","(",")"].includes(r)){e.preventDefault();return}("."!==r||this.hasMultipleDecimals(s))&&e.preventDefault()}},hasMultipleDecimals:function(e){let t=e.split(/[\+\-\*\/\(\)]/);return t.some(e=>(e.match(/\./g)||[]).length>1)},evaluateFormula:function(e){try{e=e.replace(/x/g,"*");let t=Function("return "+e)();if(t<0)return{success:!1,error:"Negative value detected. Review and amend."};return"number"==typeof t&&(t=parseFloat(t.toFixed(2))),{success:!0,result:t}}catch(r){return console.log(r),{success:!1,error:"Invalid formula syntax. Please review."}}},setError:function(e,t){e.style.border="2px solid red",e.style.backgroundColor="#ffe6e6",e.title=t,setTimeout(()=>{e.focus(),e.selectionStart=e.selectionEnd=e.value.length},10)},clearError:function(e){e.style.border="",e.style.backgroundColor="",e.title=""},attachEventListeners:function(){document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll('#calc-zone [data-class="Currency"]').forEach(e=>{e.addEventListener("focusout",function(){t.processSingleInput(this)}),e.addEventListener("keydown",t.validateKeypress.bind(t))})})}};t.attachEventListeners(),e.ExcelCalc=t}(window);